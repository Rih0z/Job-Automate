# rihobeer.com WordPress管理システム

## プロジェクト概要
rihobeer.comはクラフトビール専門のWordPressブログサイトです。ConoHaサーバーで運用されており、Claudeを使ってローカル環境で記事の管理・編集・ファクトチェックを行うシステムを構築しました。

## ユーザーの意図とプロジェクト目標

### 1. 基本的な管理システム構築
- **目的**: rihobeer.comのWordPressブログをClaudeでローカル管理できるようにする
- **要件**: ローカル環境で編集 → 問題なければサーバーにアップロード
- **実現**: SSH接続によるファイル同期システム、バックアップシステム構築

### 2. 記事のバックアップとバージョン管理
- **目的**: 全ての記事（664件）をローカルにバックアップし、GitHubで管理
- **要件**: 元のHTMLフォーマットを維持してバックアップ（Markdown変換不要）
- **実現**: 完全なHTMLドキュメントとしてバックアップ、プライベートリポジトリに保存

### 3. 記事の品質向上とファクトチェック
- **目的**: WordPress Craft Beer Article HTML Editing Guide v7.0に基づいて全664記事を更新
- **要件**: 
  - 3キャラクター（ホプくん、りほくん、ルネちゃん）による解説追加
  - SEO最適化
  - ファクトチェック実施
  - 事実と感想の明確な分離
- **実現**: 自動処理システム構築、全記事に対してガイドライン適用

### 4. 本番環境への安全なアップロード
- **最重要要件**: 元のURLを変更せずに既存記事を更新
- **明確な制約**:
  - 新しいHTMLファイルの作成・公開は禁止
  - 存在しないURLの捏造は禁止
  - 元の記事を原則そのまま更新（インプレース更新）
  - 既存HTMLファイルの直接編集・更新のみ実施
- **期待する動作**: WordPressデータベース内の既存投稿を直接更新

### 5. ファクトチェックの品質基準
- **要件**: 確認できた事実のみを記載
- **確認できた記事のみ**: 本番環境にアップロード
- **責任ある情報提供**: 事実と感想を明確に区別、信頼できる情報源の明記

## 技術的実装

### サーバー環境
- **ホスト**: 
- **SSHポート**: 
- **ユーザー**: 
- **WordPressパス**: 

### 主要スクリプト
- `backup-posts-html.js` - HTMLバックアップシステム
- `process-articles-v7.js` - ガイドライン適用処理
- `fact-check-articles.js` - ファクトチェックシステム
- `update-original-posts.js` - 既存投稿のインプレース更新

### データ管理
- **記事バックアップ**: `blog-posts-backup/` (664件のHTMLファイル)
- **処理済み記事**: `blog-posts-processed/` (ガイドライン適用済み)
- **検証済み記事**: `blog-posts-verified/` (ファクトチェック済み)
- **GitHubリポジトリ**: https://github.com/Rih0z/rihobeer.com (プライベート)

## 現在の課題と次のステップ

### 現在の状況
- 664記事の処理とファクトチェックは完了
- ただし、本番環境への更新は中断中（98,577件のWordPress投稿という膨大な数による処理時間の問題）

### ユーザーの真の要件
1. **既存記事のインプレース更新**: 新しいファイル作成ではなく、WordPressデータベース内の既存投稿内容を直接更新
2. **URL保持**: 元のパーマリンクやスラッグを一切変更しない
3. **段階的更新**: 一度に全記事ではなく、重要度の高い記事から順次更新
4. **安全性**: 本番環境への影響を最小化

### 推奨する次のアプローチ
1. **対象記事の絞り込み**: 98,577件すべてではなく、実際のビールレビュー記事（推定数百件）に限定
2. **バッチ処理の最適化**: 小さな単位での処理と進捗確認
3. **テスト環境での検証**: 本番更新前のテスト実施

## プロンプトシステム

### プロンプトファイルの配置場所
- **ディレクトリ**: `/Users/kokiriho/Documents/Blog/rihobeer/server/prompt/`
- **目的**: 新規記事作成や特定作業のための専用プロンプトを管理

### プロンプトファイル一覧
1. **rihobeer.com専用ブログ記事テーマ決定プロンプト**
   - **ファイル名**: `blog-theme-prompt.md`
   - **用途**: 新規記事のテーマ決定

2. **日本のクラフトビール業界情報収集プロンプト**
   - **ファイル名**: `japan-craft-beer-research.md`
   - **用途**: 日本国内のクラフトビール業界情報収集

3. **米国と世界のクラフトビール業界情報収集プロンプト**
   - **ファイル名**: `global-craft-beer-research.md`
   - **用途**: 海外のクラフトビール業界情報収集

4. **WordPressクラフトビール記事HTML編集マスターガイド**
   - **ファイル名**: `wordpress-html-editing-guide.md`
   - **用途**: 記事の編集・更新作業

5. **クラフトビール記事アフィリエイト商品挿入プロンプト**
   - **ファイル名**: `affiliate-product-insertion.md`
   - **用途**: アフィリエイト商品の適切な挿入

6. **HTML コンテンツの厳密な翻訳ガイド**
   - **ファイル名**: `html-translation-guide.md`
   - **用途**: HTMLコンテンツの翻訳作業

7. **モバイル最適化ビールレビュー構成要素ビジュアライズ**
   - **ファイル名**: `mobile-optimized-review-structure.md`
   - **用途**: モバイル端末向けの記事構成最適化

8. **クラフトビール記事ファクトチェックガイド**
   - **ファイル名**: `fact-checking-guide.md`
   - **用途**: 記事の事実確認・品質管理

### プロンプト使用方法
- ユーザーが特定の作業を指示する際、該当するプロンプトファイルを参照して作業を実行
- 各プロンプトは専用ファイルに保存され、必要時に読み込んで使用
- プロンプトファイルの更新は`prompt/`ディレクトリ内で管理

### プロンプト分類と使用原則

#### 新規記事作成プロンプト（HTMLファイル作成OK）
- **ブログ記事テーマ決定プロンプト** - 新規記事のテーマ決定・作成
- **日本/世界クラフトビール業界情報収集プロンプト** - ニュース系記事作成
- **SEO検索ワードからの新記事作成** - 検索需要に基づく新規記事
- **新規ブルワリー紹介記事** - 新しいブルワリーの紹介記事

#### 既存記事更新プロンプト（HTMLファイル作成禁止）
**以下のプロンプトを組み合わせて包括的に更新**:

1. **WordPressクラフトビール記事HTML編集マスターガイド** (`wordpress-html-editing-guide.md`)
   - 3キャラクターシステムの導入
   - ファクトチェック済みバッジ
   - SEO最適化要素
   - 免責事項の追加

2. **クラフトビール記事ファクトチェックガイド** (`fact-checking-guide.md`)
   - 確認済み事実セクションの追加
   - 主観的評価の明示
   - 情報源の明記

3. **クラフトビール記事アフィリエイト商品挿入プロンプト** (`affiliate-product-insertion.md`)
   - ビール購入リンク
   - 関連グッズの紹介
   - ペアリング商品

4. **モバイル最適化ビールレビュー構成要素** (`mobile-optimized-review-structure.md`)
   - レスポンシブデザイン
   - タッチフレンドリーUI
   - 表示速度最適化

**重要**: これらのプロンプトは単独ではなく、統合的に適用して包括的な改善を実施

#### 更新系プロンプトの厳格なルール
- **既存のHTMLファイルを直接更新・編集する**
- **元のURL・ファイル名・post_idを完全に保持**
- **既存記事の改善・強化のみ実施**
- **記事の基本構造は維持し、内容の精度向上や機能追加のみ**

## 記事更新ワークフロー

### 現在の実際の作業フロー
**重要**: バックアップフォルダではなく、実際に稼働中のHTMLファイル（WordPressデータベース上の投稿）に対して作業を実施

### 記事更新の重要な原則
- **自動更新スクリプトは使用しない** - 全ての更新はAIが個別に確認・処理
- **必ず更新前にバックアップを取る**
- **既存コンテンツは全て保持** - 情報量を減らさない
- **元の記事の価値を損なわない**
- **スクリプト作成前にユーザーに確認する** - 必要性を説明してから作成

### 全記事更新の標準作業手順

#### AIによる個別記事更新プロセス

**重要**: HTMLを更新する場合は、必ずpromptフォルダの中にあるファイルを利用して、Claudeで更新する。

**正しいキャラクター**:
- **ホプくん**: 技術的・客観的な情報担当（「ホップ！」で終わる）
- **りほくん**: 主観的な味覚・感想担当（普通の話し方）
- **ルネちゃん**: ペアリング・楽しみ方提案担当（「ワン！」で終わる）
1. **更新対象記事の選定**
   - ユーザーが指定した記事、または文字化けが検出された記事から選択
   - 1記事ずつ丁寧に処理（一括処理は禁止）

2. **現在の記事内容を取得**
   ```bash
   # SSHでWordPressデータベースから直接取得
   # 文字エンコーディングはUTF-8で確実に処理
   ```

3. **AIによる内容理解と改善案作成**
   - 記事の全内容を読み込み、構造と内容を理解
   - 文字化け箇所を文脈から推測して修正
   - **以下の更新プロンプトを適用**：
     - `wordpress-html-editing-guide.md` - 基本構造と3キャラクターシステム
     - `fact-checking-guide.md` - ファクトチェックと情報精度向上
     - `affiliate-product-insertion.md` - 適切なアフィリエイトリンク追加
     - `mobile-optimized-review-structure.md` - モバイル最適化
   - 各プロンプトの指示に従って包括的な改善を実施

4. **ユーザーへの確認**
   - 主要な変更点を説明
   - 必要に応じてプレビューを提示
   - ユーザーの承認を得てから実行

5. **安全な更新実行**
   - **必ずバックアップ作成** - 現在のコンテンツをJSONとSQL形式で保存
   - **WordPress管理画面からの更新が最も簡単**
     1. WordPress管理画面にログイン (wp-admin)
     2. 投稿一覧から該当記事を編集
     3. 改善されたコンテンツをコピー&ペースト
     4. 更新ボタンをクリック
   - キャッシュクリア
   - 更新結果の確認

#### 従来の手順（参考）
1. **更新前のバックアップ** - 必ず現在の状態を保存
2. **既存コンテンツの確認** - 元の記事内容を完全に把握
3. **ライブサーバーでの直接更新** - WordPressデータベース内の実際の投稿を直接更新
4. **プロンプト従った更新** - WordPress HTML編集マスターガイドv7.0に準拠
5. **ファクトチェック実施** - 事実と感想の明確な分離、信頼できる情報源の確認
6. **アフィリエイト挿入** - 自然で価値のあるリンク配置
7. **モバイル最適化** - レスポンシブデザイン、表示速度最適化
8. **サイトアクセシビリティ確認** - 更新後の動作確認必須

### 記事更新の技術要素
- **ファクトチェック済みバッジ**: 確認できた事実と個人的感想の明確な区別
- **3キャラクターシステム**: ホプくん（技術的情報）、りほくん（主観的感想）、ルネちゃん（ペアリング提案）
- **SEO最適化**: 構造化データ、適切なメタデータ、内部リンク
- **モバイルファースト**: レスポンシブ対応、タッチフレンドリー、高速表示
- **アフィリエイト統合**: 読者価値を重視した自然な商品紹介

### 品質管理基準
- URL構造の完全保持（最重要）
- 既存コンテンツの価値向上
- 事実情報の正確性確保
- 読者体験の改善
- サイトパフォーマンス維持

## 重要な学習ポイント
- ユーザーは「新しいコンテンツの作成」ではなく「既存コンテンツの改善」を求めている
- URL構造の保持が最優先事項
- **既存コンテンツの情報量を絶対に減らさない**
- ファクトチェックと責任ある情報提供への強いこだわり
- 段階的で安全なアプローチを重視
- 専用プロンプトシステムによる効率的な作業実行
- 全記事に対する包括的な品質向上が目標
- **自動スクリプトによる一括更新は避け、AIが個別に内容を確認して更新**
- **スクリプト作成前に必ずユーザーに確認** - 本当に必要か、どのような目的かを説明
- **AIの能力を最大限活用** - 機械的な置換ではなく、内容を理解した上での改善

## 過去の失敗から学んだこと

### 1. コンテンツ置き換えによる情報量減少の禁止
- **問題**: 既存記事の完全な内容を削除し、最小限のテンプレートに置き換えた
- **結果**: 40,000文字の記事が4,500文字に減少、大量の情報が失われた
- **対策**: 
  - **既存コンテンツは必ず全て保持する**
  - **情報量を減らさない**
  - **追加・改善のみ実施**
  - **削除・置き換えは禁止**

### 2. 文字エンコーディング問題の予防
- **問題**: UTF-8文字が「?」や文字化けで表示される
- **原因**: データベース接続時の文字エンコーディング設定ミス
- **対策**:
  - **SET NAMES utf8mb4**を必ず実行
  - **Base64エンコーディング**でMySQLクエリを安全化
  - **UTF-8対応の確認**を更新前に実施

### 3. キャラクター画像URL混在の防止
- **問題**: ホプくん、りほくん、ルネちゃんの画像URLが混在
- **原因**: プロンプトに正確な画像マッピングが記載されていない
- **対策**:
  - **正確な画像マッピング**をプロンプトに明記
  - **ホプくん**: iconid="5047" (IMG_3351-150x150.jpeg)
  - **りほくん**: iconid="5049" (IMG_3352-150x150.jpeg)
  - **ルネちゃん**: iconid="5050" (IMG_3353-150x150.jpeg)

### 4. タイトル変更の制限
- **問題**: 【ファクトチェック済み】を勝手にタイトルに追加
- **対策**: **タイトルは既存のものを保持**、不要な追加をしない

### 5. 必須の安全対策
- **更新前の必須バックアップ** - 現在の状態を必ず保存
- **WordPressリビジョンの活用** - 緊急時の復元手段
- **段階的更新** - 一度に大量更新せず個別確認
- **キャッシュクリア** - 更新後の表示確認

### 6. 記事更新の実際の手順

#### WordPress管理画面からの更新（推奨）
1. **バックアップ** - SSHでデータベースから現在のコンテンツをエクスポート
2. **管理画面アクセス** - `https://rihobeer.com/wp-admin/`
3. **投稿編集** - 該当記事を検索して編集モードへ
4. **コンテンツ置換** - 既存コンテンツを全選択して削除、新しいコンテンツを貼り付け
5. **更新** - 「更新」ボタンをクリック
6. **キャッシュクリア** - 必要に応じてサーバーキャッシュをクリア

#### データベース直接更新（上級者向け）
- phpMyAdminやSSH経由でSQLを実行
- UTF-8エンコーディングに注意
- 必ずトランザクションで実行

### 7. 更新時の厳格なルール
- **情報量を減らさない** - 既存の全ての情報を保持
- **文字エンコーディング確認** - UTF-8で正しく表示されるか確認
- **キャラクター画像確認** - 正しいアイコンが表示されるか確認
- **タイトル保持** - 元のタイトルを変更しない
- **URL保持** - パーマリンクとスラッグを変更しない
