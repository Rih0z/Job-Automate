# 3エージェント開発システム (TDD強化版)

## 概要
3つのAIエージェント（進行役・実行者・レビュアー）が、テスト駆動開発（TDD）を前提に協調するための運用方法です。従来の「要件定義→基本設計→詳細設計...」といった厳密なフェーズ分割は廃止し、短いイテレーションを回しながら常にテストから着手するプロセスに刷新しました。

## ロール構成
| エージェント | 役割 | ターミナル | 主なアウトプット |
|-------------|------|-----------|------------------|
| 🎩 リーダー（進行役） | ゴール設定、テスト方針とタスク分解、次サイクル指示 | ターミナル1 | `---LEADER OUTPUT START---` と `.tmp/leader_instructions/...` |
| 👨‍💻 実行エージェント | テスト→実装→リファクタのTDDサイクル実行 | ターミナル2 | `---OUTPUT START---` と `.tmp/実行/...` |
| 🔍 レビューエージェント | テストと実装の品質評価、改善指示 | ターミナル3 | `---REVIEW OUTPUT START---` と `.tmp/レビュー/...` |

## コア原則
1. **テストファースト**: 失敗する自動テストを書くことから全作業を始める。
2. **3セッション分離**: それぞれ独立したターミナル/モデルで動かし、客観性を担保する。
3. **.tmp配下への保存**: すべての計画・成果物・レビューを `.tmp/` 以下に保存し、`---CREATED FILES---` で完全パスを必ず列挙する。
4. **イテレーション駆動**: 詳細設計などの固定フェーズは使わず、「目的→テスト戦略→実装→レビュー」を繰り返す。
5. **透明性**: 重要な決定・仮定・リスクは必ず文書化し、次エージェントに引き継ぐ。
6. **長期的計画の追跡**: プロジェクトの長期的計画（ロードマップ）の完全パスを `---LONG TERM PLAN---` セクションで常に出力し、全エージェントが現在位置を把握する。

## 参考資料と準拠方針
- **Anthropic: _Build better software with Claude Code_ (https://www.anthropic.com/news/claude-code, 2024)**
  - 同記事で強調されている「自動テストから着手し、テスト→実装→リファクタの短いサイクルを繰り返す」手順を基に、本READMEと各プロンプトのTDD強化方針を策定。
  - Anthropicが推奨する「作業内容を構造化テンプレートに落とし込み、別エージェントでの客観性を担保する」運用を踏まえて、3エージェント分離と`.tmp`配下での成果物管理を必須化。
- 各プロンプト（リーダー/実行/レビュー）は同資料を参照し、節ごとにテスト戦略・証跡・レビュー観点を明文化しています。詳細は各プロンプト冒頭の「参考ドキュメント」節を参照してください。

## テスト駆動ワークフロー
### 1. リーダー（進行役）
- ユーザー要望や最新のレビュー結果を踏まえてイテレーション目標を定義。
- 先に書くべきテスト、必要な環境、優先度付きタスクを明記した計画＆実行指示を出力。
- 計画書を `.tmp/leader_instructions/iteration_[ID].md` などに保存させ、完全パスを報告させる。

### 2. 実行エージェント
- リーダーの `---EXECUTION INSTRUCTION---` に従い、テスト→実装→リファクタの順で作業。
- 追加・変更したテスト、実装差分、検証結果を `---OUTPUT DOCUMENT---` にまとめ、対応する `.tmp/` ディレクトリへ保存。

### 3. レビューエージェント
- テストファーストの証跡、テストカバレッジ、実装の正当性、ドキュメントのトレーサビリティを厳しく評価。
- 100点未満なら改善事項を列挙し、100点なら次のイテレーション開始を明示。
- **100点達成時は `---DOCUMENT UPDATE REQUEST---` セクションでドキュメント更新者向けの更新依頼を作成する。**

### 4. ループ条件
- **100点未満**: レビュー結果 + 前回成果物 + 実行プロンプトをターミナル2へ戻し、改善。
- **100点**: レビュー結果 + リーダープロンプトをターミナル1へ渡し、次のイテレーションを計画。
- すべての目標が満たされたらリーダーの完了出力テンプレートで締める。

## .tmp保存と完全パス出力
- 推奨構造:
  ```
  .tmp/
  ├── leader_instructions/iteration_01_plan.md
  ├── execution/iteration_01_20260127/document.md
  └── review/iteration_01_20260127/
      ├── review_report.md
      ├── feedback.json
      └── document_update_request.md  (100点達成時のみ)
  ```
- 各エージェントは成果物を保存した直後に `---CREATED FILES---` セクションで完全パスを列挙し、必ず `.tmp` 配下であることを確認してください。
- リーダーの計画ファイルの完全パスは、必ず出力末尾で報告させる（従来手順を継承）。

## プロンプトファイル
| ファイル | 用途 | リンク |
|---------|------|--------|
| リーダープロンプト.md | 進行役（ターミナル1） | [GitHub](https://github.com/Rih0z/Job-Automate/blob/main/Coding/Base/%E3%83%AA%E3%83%BC%E3%83%80%E3%83%BC%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88.md) |
| 実行プロンプト.md | 実行エージェント（ターミナル2） | [GitHub](https://github.com/Rih0z/Job-Automate/blob/main/Coding/Base/%E5%AE%9F%E8%A1%8C%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88.md) |
| レビュープロンプト.md | レビューエージェント（ターミナル3） | [GitHub](https://github.com/Rih0z/Job-Automate/blob/main/Coding/Base/%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88%20%C2%B7%20MD) |
| README.md | 本ファイル | [GitHub](https://github.com/Rih0z/Job-Automate/blob/main/Coding/Base/README.md) |

## 実行手順（各ターミナル）
1. **ターミナル1**: ユーザー要望 + リーダープロンプトを入力し、最新のイテレーション計画と実行指示を取得。
2. **ターミナル2**: リーダーの `---EXECUTION INSTRUCTION---` + 実行プロンプトを貼り付け、テストファーストで成果物を作成。
3. **ターミナル3**: 実行結果 + レビュープロンプトでレビュー、点数と改善指示を出力。
4. 点数に応じて 2 または 1 に戻る。完了時はリーダーの完了テンプレートで締める。

## FAQ
### Q. 旧フェーズ表記（詳細設計など）はもう使いませんか？
A. はい。イテレーション単位で目的とテスト方針を定義し、テストファーストで進めてください。旧テンプレートは `<details>` 内に保存してありますが参照のみです。

### Q. テストを先に書いた証跡はどう残しますか？
A. 実行プロンプトの出力テンプレートに「テストファーストの進め方」「追加テスト一覧」を必ず含め、`.tmp/` 内にはテストコードとメタデータを保存し、完全パスを `---CREATED FILES---` で報告してください。

## バージョン情報
- **Version**: 4.0
- **Last Updated**: 2026-01-27

---

<details>
<summary>旧バージョン（ウォーターフォール手順付き）</summary>

# 3エージェント開発システム

## 概要

3つのAIエージェントが協働してソフトウェア開発を進めるシステムです。

| エージェント | 役割 | ターミナル |
|-------------|------|-----------|
| 🎩 リーダー | 全体統括・次フェーズ指示 | ターミナル1 |
| 👨‍💻 実行 | 設計・実装の作成 | ターミナル2 |
| 🔍 レビュー | 品質評価・改善指示 | ターミナル3 |

## ⚠️ 最重要：3つの別セッション

**必ず3つの別々のAIセッション（別々のターミナル）で実行してください。**

同じセッションで複数の役割を実行すると、客観性が失われ、システムが機能しません。

## 📎 プロンプトファイル

| ファイル | 用途 | リンク |
|---------|------|--------|
| リーダープロンプト.md | リーダーエージェント用 | [GitHub](https://github.com/Rih0z/Job-Automate/blob/main/Coding/Base/%E3%83%AA%E3%83%BC%E3%83%80%E3%83%BC%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88.md) |
| 実行プロンプト.md | 実行エージェント用 | [GitHub](https://github.com/Rih0z/Job-Automate/blob/main/Coding/Base/%E5%AE%9F%E8%A1%8C%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88.md) |
| レビュープロンプト.md | レビューエージェント用 | [GitHub](https://github.com/Rih0z/Job-Automate/blob/main/Coding/Base/%E3%83%AC%E3%83%93%E3%83%A5%E3%83%BC%E3%83%97%E3%83%AD%E3%83%B3%E3%83%97%E3%83%88%20%C2%B7%20MD) |
| README.md | このファイル | [GitHub](https://github.com/Rih0z/Job-Automate/blob/main/Coding/Base/README.md) |

## ワークフロー図

```
┌─────────────────────────────────────────────────────────────────┐
│                     プロジェクト開始                              │
│           ユーザーの要望 + リーダープロンプト                       │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ 【ターミナル1: リーダー】                                         │
│                                                                 │
│ 入力: ユーザーの要望 + リーダープロンプト                          │
│ 出力: プロジェクト計画 + 実行指示                                 │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ 【ターミナル2: 実行】                                             │
│                                                                 │
│ 入力: リーダーの指示 + 実行プロンプト                              │
│ 出力: 成果物（---OUTPUT DOCUMENT---）                            │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│ 【ターミナル3: レビュー】                                         │
│                                                                 │
│ 入力: 実行の出力 + レビュープロンプト                              │
│ 出力: 評価結果（XX/100点）                                       │
└─────────────────────────────────────────────────────────────────┘
                              │
                    ┌─────────┴─────────┐
                    │                   │
                    ▼                   ▼
            ┌───────────┐       ┌───────────┐
            │ 100点未満  │       │  100点    │
            └───────────┘       └───────────┘
                    │                   │
                    ▼                   ▼
┌─────────────────────────┐   ┌─────────────────────────┐
│ 【ターミナル2: 実行】     │   │ 【ターミナル1: リーダー】 │
│                         │   │                         │
│ 入力:                   │   │ 入力:                   │
│ ・レビュー結果          │   │ ・レビュー結果（100点）  │
│ ・前回の成果物          │   │ ・リーダープロンプト     │
│ ・実行プロンプト        │   │                         │
│                         │   │ 出力:                   │
│ 出力: 改善版成果物       │   │ ・次フェーズの実行指示   │
└─────────────────────────┘   └─────────────────────────┘
            │                           │
            │                           │
            ▼                           ▼
      レビューへ戻る              次フェーズの実行へ
      (100点まで繰り返し)         (ターミナル2へ)
```

## 開発フェーズ

```
要件定義 → 基本設計 → 詳細設計 → 実装 → テスト → 完了
   │         │          │        │       │
   └─────────┴──────────┴────────┴───────┘
           各フェーズ100点で次へ
```

## 具体的な使い方

### Step 1: プロジェクト開始（リーダー）

**ターミナル1**で新しいセッションを開始：

```
こんにちは！以下のプロジェクトを開始したいです。

【プロジェクト概要】
在庫管理Webアプリを作りたい

【主な機能】
- 商品の登録・編集・削除
- 在庫数のリアルタイム表示
- CSVエクスポート

【制約】
- 2週間で完成
- シンプルなUI

---

[リーダープロンプト全体を貼り付け]
```

### Step 2: 実行（実行エージェント）

**ターミナル2**で新しいセッションを開始：

```
[リーダーの出力（---EXECUTION INSTRUCTION---部分）を貼り付け]

---

[実行プロンプト全体を貼り付け]
```

### Step 3: レビュー（レビューエージェント）

**ターミナル3**で新しいセッションを開始：

```
[実行の出力（---OUTPUT DOCUMENT--- と ---OUTPUT METADATA---）を貼り付け]

---

[レビュープロンプト全体を貼り付け]
```

### Step 4a: 100点未満の場合 → 改善サイクル

**ターミナル2（実行）**に戻る：

```
【レビュー結果】
総合得点: 75点

必須改善事項:
1. ○○が不足している
2. △△が曖昧

---

【前回の成果物】
---OUTPUT DOCUMENT---
[前回の内容をそのまま貼り付け]
---

---

[実行プロンプト全体を貼り付け]
```

→ 改善版を作成 → **Step 3**に戻ってレビュー → 100点まで繰り返し

### Step 4b: 100点の場合 → 次フェーズへ

**ターミナル1（リーダー）**に戻る：

```
【レビュー結果】
総合得点: 100点
評価: 完璧

次フェーズ: 基本設計

---

[リーダープロンプト全体を貼り付け]
```

→ リーダーが次フェーズの指示を出力 → **Step 2**へ

## フローのまとめ

| 状況 | 次のアクション |
|------|---------------|
| プロジェクト開始 | ユーザー要望 + リーダープロンプト → リーダーへ |
| リーダー完了 | リーダー出力 + 実行プロンプト → 実行へ |
| 実行完了 | 実行出力 + レビュープロンプト → レビューへ |
| レビュー100点未満 | レビュー出力 + 前回成果物 + 実行プロンプト → 実行へ |
| レビュー100点 | レビュー出力 + リーダープロンプト → リーダーへ |
| 全フェーズ100点 | 🎉 プロジェクト完了！ |

## よくある質問

### Q: なぜ3つのセッションが必要？
**A**: 同じセッションだと、実行者が自分の成果物を自分でレビューすることになり、客観性が失われます。

### Q: どのAIツールを使うべき？
**A**: ClaudeCode、ChatGPT、Geminiなど何でもOK。重要なのは「3つの別セッション」であること。

### Q: 100点にならない場合は？
**A**: 改善サイクルを繰り返してください。妥協せず100点を目指すことで品質が向上します。

---

**Version**: 3.0
**Last Updated**: 2025-01-30
</details>
