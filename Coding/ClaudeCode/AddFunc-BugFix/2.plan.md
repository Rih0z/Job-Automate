# ステップ2: Serena MCPアーキテクチャ分析・計画策定プロンプト

あなたはアーキテクチャ分析の専門家です。バグ修正または機能追加について、Serena MCPを使用してシステムアーキテクチャの詳細分析と最適な実装計画を作成してください。

## 入力資料
- tmpフォルダ内の自動分析結果（OSS調査を含む）
- docsフォルダのアーキテクチャ資料
- 発見されたOSSプロジェクトの実装資料

## Serena MCP分析指示

### 1. アーキテクチャ分析コマンド

#### バグ修正用
```bash
# バグ修正によるアーキテクチャ影響分析
@serena analyze-bug-impact --bug-description "[バグ内容]" --source docs/ --codebase ./ --reference-implementations tmp/

# 修正方針のアーキテクチャ妥当性確認（OSS手法を含む）
@serena validate-fix --fix-approach "[修正アプローチ]" --oss-references "[参考OSS実装]"

# OSS修正手法の自システム適用分析
@serena adapt-oss-solution --oss-approach "[OSS修正方法]" --target-system docs/
```

#### 機能追加用
```bash
# 新機能追加のアーキテクチャ設計（OSS参考を含む）
@serena design-feature --feature-description "[機能内容]" --existing-arch docs/ --oss-examples tmp/

# 既存システムとの統合分析（OSS実装パターン参考）
@serena integration-analysis --new-feature "[機能仕様]" --reference-patterns "[参考OSS実装]"

# OSS実装パターンの最適化・カスタマイズ
@serena customize-oss-pattern --oss-implementation "[OSS実装]" --target-constraints docs/
```

#### 共通
```bash
# システム全体のアーキテクチャ分析
@serena analyze-architecture --source docs/ --codebase ./
```

### 2. 分析対象項目

#### バグ修正の場合
- 修正対象箇所のアーキテクチャ分析
- 修正による他システムへの影響評価
- パッチ適用の最適な方法
- 将来の類似バグ予防策
- **OSS修正手法の適用評価**
  - 参考OSS手法の技術的妥当性
  - 自システムへの適用可能性
  - 必要なカスタマイズ・改良点

#### 機能追加の場合
- 新機能のアーキテクチャ設計
- 既存システムとの統合方式
- データフロー・API設計
- スケーラビリティ考慮
- **OSS実装パターンの活用**
  - 優秀なOSS設計の自システム適用
  - 実装効率向上のためのパターン採用
  - ライセンス・技術的制約の考慮

#### 共通項目
- システム構造分析
- モジュール間の結合度・凝集度評価
- セキュリティ要件の確認
- パフォーマンス最適化案

### 3. Serena MCP出力指示

#### バグ修正用出力
```
@serena output-analysis --format structured --sections:
- bug-impact-assessment
- fix-strategy
- risk-mitigation
- testing-approach
- rollback-plan
```

#### 機能追加用出力
```
@serena output-analysis --format structured --sections:
- feature-architecture
- implementation-roadmap
- integration-strategy
- scalability-plan
- deployment-strategy
```

## 期待される分析結果

### バグ修正の場合
#### 修正影響分析
- 修正箇所とその影響範囲
- 修正による副作用の予測
- 最小限の変更で最大効果を得る方法

#### 修正戦略
- 段階的修正計画
- テスト戦略
- ロールバック計画

### 機能追加の場合
#### アーキテクチャ設計
- 新機能のシステム構成図
- 既存システムとの統合ポイント
- データフローの設計

#### 実装ロードマップ
- 段階的実装計画
- 各フェーズでの成果物
- 技術的依存関係

### 共通項目
#### リスク評価
- 技術的リスクの特定
- 運用継続性の評価
- 品質への影響

#### 最適化提案
- パフォーマンス改善案
- 保守性向上のための提案
- 将来拡張への対応策

## 出力ファイル
`tmp/serena_analysis_plan_[現在日時].md`

## Serena MCP活用のポイント
- 既存のdocsフォルダの設計書を参照させる
- コードベース全体の構造を把握させる
- 業界のベストプラクティスとの比較分析
- 具体的で実行可能な提案を求める

## 品質基準
- 技術的に実現可能な提案
- 既存システムとの整合性確保
- 将来の保守性を考慮した設計
- パフォーマンスとセキュリティの両立
- Ultrathink. Don't hold back. give it your all！
