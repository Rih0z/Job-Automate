# 📋 統合プロンプト概要：効率的な4段階ワークフロー

## 🎯 改善された構成（.tmp段階作業による安全性確保）

### ✅ **統合前の課題を解決 + 新たな安全性保証**
- **プロンプト重複**: 関連作業を統合し効率化
- **固定パス問題**: プロジェクト固有のドキュメント構造を自動検出・適応
- **README.md過多**: 1分読了の簡潔版に変更、詳細は内部ドキュメントへ
- **既存ドキュメント無視**: 既存構造の探索・更新ロジックを組み込み
- **⭐ ファイル名変更問題**: **既存ファイル名を完全保持、更新優先戦略**
- **🛡️ 新: 作業中破損リスク**: **.tmp段階作業による既存ファイル完全保護**

### 🔄 **.tmp段階作業による安全な4段階ワークフロー**

#### 1️⃣ **コードベース分析 & アーキテクチャ図生成**
**🛡️ .tmp段階作業戦略**
```bash
# .tmp/arch-work/ 内での安全な作業
serena setup-workspace --temp-dir=".tmp/arch-work" --preserve-existing
serena copy-existing-docs --source="." --destination=".tmp/arch-work/original"
serena work-in-tmp ".tmp/arch-work" --preserve-file-names --enhance-content
# 承認後に本番配置
```

#### 2️⃣ **API仕様書 & 簡潔README.md更新**  
**🛡️ .tmp段階作業戦略**
```bash
# .tmp/api-work/ と .tmp/readme-work/ での分離作業
serena create-api-workspace ".tmp/api-work" --safe-mode
serena create-readme-workspace ".tmp/readme-work" --60-second-target
# .tmp内で確認・承認後に配置
```

#### 3️⃣ **技術仕様書 & 変更履歴管理**
**🛡️ .tmp段階作業戦略**
```bash
# .tmp/tech-work/ と .tmp/changelog-work/ での安全作業
serena setup-tech-workspace ".tmp/tech-work" --existing-file-priority
serena setup-changelog-workspace ".tmp/changelog-work" --format-preservation
# .tmp内で品質確認・承認後に配置
```

#### 4️⃣ **統合検証 & GitHub Push**
**🛡️ .tmp統合検証戦略**
```bash
# 全.tmpワークスペースの統合検証・安全配置
serena consolidate-tmp-workspaces --all-areas
serena validate-tmp-integration --deployment-ready
serena deploy-from-tmp --existing-file-protection
```

## 🚀 **主要な改善点（.tmp段階作業による安全性強化）**

### 📂 **.tmp段階作業による既存ドキュメント完全保護**
```bash
# 各段階で実行される安全な作業フロー
1. serena copy-existing-to-tmp --preserve-all --safe-backup
2. serena work-in-tmp-isolation --no-original-file-touch
3. serena validate-tmp-results --quality-check --approval-process
4. serena deploy-from-tmp --existing-file-names-priority --safe-replacement
```

### ⏱️ **README.md 1分読了設計（.tmp段階検証）**
```markdown
# .tmp段階での README.md 作業フロー
1. .tmp/readme-work/README.md にコピー
2. .tmp内で重要情報抽出・保持
3. .tmp内で1分読了版作成・測定
4. .tmp内で詳細情報の適切な移行先作成
5. 承認後に本番配置（README.md ← .tmp/readme-work/README-final.md）

詳細移行先（.tmp段階で作成・検証）:
• 🏗️ アーキテクチャ → [existing-architecture.md] (.tmp検証済み)
• 🔌 API仕様 → [existing-api.md] (.tmp検証済み)
• 🚀 セットアップ詳細 → DEVELOPMENT.md (.tmp段階作成・検証済み)
```

### 🔄 **.tmp段階作業による既存ファイル更新ロジック**
```bash
# .tmp段階での既存ファイル安全更新フロー
if [ -f "architecture.md" ]; then
    # 1. .tmp に安全コピー
    cp "architecture.md" ".tmp/arch-work/original/architecture.md"
    # 2. .tmp内で作業（元ファイル無修正）
    serena update-in-tmp ".tmp/arch-work/original/architecture.md" --output=".tmp/arch-work/architecture-enhanced.md"
    # 3. .tmp内で品質確認・承認
    serena validate-tmp-result ".tmp/arch-work/architecture-enhanced.md"
    # 4. 承認後に安全配置
    serena deploy-from-tmp ".tmp/arch-work/architecture-enhanced.md" --destination="architecture.md" --backup-original
fi
```

## 📋 **実行手順（.tmp段階作業による安全性確保）**

### **準備（.tmp環境構築）**
```bash
# .tmp作業環境の準備・既存ファイル保護
mkdir .tmp 2>/dev/null || echo ".tmp already exists"
serena setup-tmp-workspaces --all-areas --safe-mode

# 既存ドキュメントの安全確保
backup_dir="backup-docs-$(date +%Y%m%d-%H%M)"
mkdir "$backup_dir"
cp -r *.md docs/ "$backup_dir/" 2>/dev/null
echo "🛡️ 既存ファイル安全確保: $backup_dir/"
```

### **実行順序（.tmp段階確認付き）**
1. **プロンプト1実行** → `.tmp/arch-work/` で作業 → 承認 → 配置
2. **プロンプト2実行** → `.tmp/api-work/`, `.tmp/readme-work/` で作業 → 承認 → 配置  
3. **プロンプト3実行** → `.tmp/tech-work/`, `.tmp/changelog-work/` で作業 → 承認 → 配置
4. **プロンプト4実行** → `.tmp`統合検証 → 最終承認 → GitHub Push

### **各段階の.tmp作業確認ポイント**
- プロンプト1: **`.tmp/arch-work/`内で既存architecture.md更新確認** → 承認 → 配置
- プロンプト2: **`.tmp/readme-work/`内でREADME.md 1分読了確認** → 承認 → 配置
- プロンプト3: **`.tmp/tech-work/`内で技術仕様強化確認** → 承認 → 配置
- プロンプト4: **全`.tmp`統合で破壊的変更ゼロ確認** → 最終承認 → Push

**合計: 約60-75分で.tmp段階確認付き・既存ドキュメント体系の完全安全強化**

## 🎯 **期待される成果（.tmp段階作業保証付き）**

### **🛡️ 安全性・信頼性の劇的向上**
| 安全性項目 | 従来の問題 | .tmp段階作業による解決 |
|----------|-----------|---------------------|
| 作業中破損 | 直接編集でファイル破損リスク | `.tmp`内作業で元ファイル完全保護 |
| 途中失敗 | やり直し時の復旧困難 | `.tmp/original/`から即座復旧 |
| 品質不安 | 一発本番での品質リスク | `.tmp`内で段階確認・承認プロセス |
| チーム影響 | 作業中の他チームメンバーへの影響 | 配置まで既存環境無影響 |
| **🔍 実装乖離** | **ドキュメントと実装の不整合** | **`.tmp`内で実装同期確認・古い情報削除** |

### **📈 ドキュメント品質（.tmp段階検証済み + 実装同期）**
- ✅ **既存情報保持**: `.tmp`段階で重要情報の完全保持確認
- ✅ **最新性**: `.tmp`内でコード同期確認後配置  
- ✅ **一貫性**: `.tmp`統合検証での整合性確認済み配置
- ✅ **互換性**: `.tmp`段階でリンク・ブックマーク互換性確認
- ✅ **🔍 実装整合性**: `.tmp`段階で実装コードとの完全同期確認
- ✅ **🗑️ 古い情報削除**: 廃止された機能・API・設定の自動削除

### **🚀 プロセス改善効果**
- ✅ **透明性**: 各段階の成果物が`.tmp`内で確認可能
- ✅ **品質**: 段階的承認による高品質保証
- ✅ **安全性**: 既存ファイル破損リスク完全回避
- ✅ **効率**: 問題発見時の早期修正・段階やり直し
- ✅ **🔍 正確性**: 実装との乖離検出・自動修正

## ⚠️ **注意事項（.tmp段階作業における確認点）**

### **実行前確認（.tmp環境準備）**
- [ ] `.tmp`フォルダの書き込み権限確認
- [ ] 既存ドキュメントの重要度・依存関係把握
- [ ] `.tmp`作業スペース要件（ディスク容量等）確認
- [ ] チーム作業スケジュールとの調整

### **各段階後の.tmp確認**
- [ ] `.tmp`内成果物の品質・完成度確認
- [ ] 既存ファイルとの差分・改善点確認
- [ ] 段階承認（品質OK）の確認・記録
- [ ] 配置前の最終整合性確認

### **.tmp作業履歴・監査対応**
- [ ] 各段階の作業過程が`.tmp/archive/`に記録されているか
- [ ] 問題発生時の原因調査・復旧手順の確認
- [ ] チーム共有用の作業報告・成果サマリー準備

---

**40年のベテランエンジニアの知見 + .tmp段階作業による完全安全保証により、既存ドキュメント資産を一切破損することなく、最高品質のドキュメント体系を実現する革新的ワークフローです。**

## 📋 **実行手順（既存ファイル保護）**

### **準備**
```bash
# 既存ドキュメントのバックアップ（安全確保）
mkdir backup-docs-$(date +%Y%m%d)
cp -r *.md docs/ backup-docs-$(date +%Y%m%d)/ 2>/dev/null

# Serena MCPの既存ファイル検出能力確認
serena check-existing-docs --detection-accuracy
```

### **実行順序（既存ファイル優先）**
1. **プロンプト1実行** → 既存アーキテクチャ文書更新・図表強化
2. **プロンプト2実行** → 既存README/API仕様の最適化  
3. **プロンプト3実行** → 既存技術仕様・CHANGELOG強化
4. **プロンプト4実行** → 整合性検証・GitHub Push

### **各段階の成果（既存ファイル名保持）**
- プロンプト1: **[既存architecture.md更新]** + 図表追加
- プロンプト2: **[README.md簡潔化]** + **[既存API仕様強化]**
- プロンプト3: **[CHANGELOG.md統一]** + **[既存技術仕様詳細化]**
- プロンプト4: **[リンク切れゼロでGitHub Push]**

**合計: 約60-75分で既存ドキュメント体系の包括的強化**

## 🎯 **期待される成果（既存構造保持）**

### **チーム・プロジェクトへの配慮**
| 配慮項目 | 従来の問題 | 改善後 |
|---------|-----------|-------|
| ファイル名変更 | リンク切れ・混乱 | **変更なし・完全保持** |
| フォルダ構造 | 慣例の破綻 | **既存構造尊重・補完のみ** |
| チーム慣例 | スタイル変更 | **既存慣例完全準拠** |
| CI/CD連携 | パス変更で破綻 | **既存パス保持・互換性確保** |

### **ドキュメント品質（既存ベース向上）**
- ✅ **既存情報保持**: 重要な既存内容を全て保持
- ✅ **最新性**: 既存文書をコードと自動同期  
- ✅ **一貫性**: 既存スタイルを尊重した統合検証
- ✅ **互換性**: 既存リンク・ブックマークの完全保護

### **ゼロ破壊的変更**
- ✅ **ファイル名**: 一切変更なし
- ✅ **既存リンク**: 100%互換性維持
- ✅ **チーム慣例**: 完全保持・強化のみ
- ✅ **CI/CD**: 既存パイプラインとの完全互換

## ⚠️ **注意事項（既存ファイル保護）**

### **実行前確認**
- [ ] 既存ドキュメントの重要度確認
- [ ] バックアップ作成（重要ファイル）
- [ ] チーム慣例・命名規則の把握
- [ ] 既存CI/CDパイプラインでのドキュメント参照確認

### **各段階後の確認**
- [ ] 既存ファイル名が保持されているか
- [ ] 既存リンクが有効か
- [ ] 重要な既存情報が保持されているか  
- [ ] チーム固有スタイルが維持されているか

---

**40年のベテランエンジニアの知見 + 既存ドキュメント資産の完全保護により、プロジェクトの継続性を保ちながらドキュメント品質を劇的に向上させる統合ワークフローです。**

## 📋 **実行手順**

### **準備**
```bash
# Serena MCPの確認
serena --version
serena check-project-compatibility
```

### **実行順序**
1. **プロンプト1実行** → アーキテクチャ基盤完成
2. **プロンプト2実行** → API & 入口完成
3. **プロンプト3実行** → 技術詳細 & 履歴完成
4. **プロンプト4実行** → 検証・GitHub Push

### **各段階の所要時間目安**
- プロンプト1: 15-20分（初回分析）
- プロンプト2: 10-15分（API抽出・README作成）
- プロンプト3: 20-25分（技術仕様詳細化）
- プロンプト4: 10-15分（検証・プッシュ）

**合計: 約60-75分で完全なドキュメント更新**

## 🎯 **期待される成果**

### **ユーザー体験向上**
| 対象者 | 従来 | 改善後 | 時間短縮 |
|--------|------|-------|----------|
| 新規開発者 | README迷子 | 1分で概要把握 | 80%削減 |
| API利用者 | 仕様書探し | 自動同期済み仕様 | 70%削減 |
| 保守担当者 | 散在文書検索 | 体系化された技術仕様 | 60%削減 |

### **ドキュメント品質**
- ✅ **最新性**: コードと自動同期
- ✅ **一貫性**: 統合検証による整合性確保  
- ✅ **アクセシビリティ**: 段階的詳細度設計
- ✅ **保守性**: 自動更新パイプライン

### **プロジェクト適応性**
- ✅ **既存構造尊重**: 自動検出・適応
- ✅ **命名規則準拠**: プロジェクト固有慣例に従う
- ✅ **段階的導入**: 部分実行も可能
- ✅ **継続的改善**: 定期更新の自動化

## ⚠️ **注意事項**

### **実行前確認**
- [ ] Serena MCPの動作確認
- [ ] Git作業ブランチの準備
- [ ] 既存ドキュメントのバックアップ
- [ ] プロジェクト固有要件の確認

### **各段階後の確認**
- [ ] 生成ファイルの確認
- [ ] リンク整合性の検証
- [ ] チーム固有要件への適合
- [ ] セキュリティ要件の確認

---

**40年のベテランエンジニアの知見を活用し、プロジェクトのドキュメント品質を劇的に向上させる統合ワークフローです。**
